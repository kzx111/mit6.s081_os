# xv6整体架构

## bio.c

这里就是文件系统的**第二层**，直接与virtio虚拟硬盘交互，负责512B**扇区**的原始读写操作（扇区是是磁盘驱动可以读写的最小单元）。**块**（Block）是文件系统操作的**基本单位**（xv6使用1024字节块，是磁盘扇区大小的2倍）

* struct bcache来作为缓冲区（双链表）

* bint()初始化缓冲区
* bget()根据设备类型和数据块编号来获取缓存块，知道了就返回，没有找到就利用rlu机制来选择没有进程占用的缓冲区，如果此时所有的缓冲区都被进程占用，那就panic
* bread()利用bget函数获得缓冲区，若该缓冲区没有要读的数据，即数据还未从磁盘读入内存，这调用virtio_disk_rw来读取。该函数virtio_disk_rw是属于磁盘驱动程序的。
* bwrite()将缓冲区的内容写入磁盘中。
* brelse()缓冲区的引用减一，若此时为0，则将该缓冲区放到对头
* bpin()就是该缓冲块的引用数加一
* bunpin()就是缓冲块的引用数减一





##  Inode

